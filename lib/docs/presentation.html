<!DOCTYPE html>  <html> <head>   <title>presentation.js</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>            <div id="jump_to">         Jump To &hellip;         <div id="jump_wrapper">           <div id="jump_page">                                           <a class="source" href="controls.html">                 controls.js               </a>                                           <a class="source" href="frame.html">                 frame.js               </a>                                           <a class="source" href="pik.html">                 pik.js               </a>                                           <a class="source" href="presentation.html">                 presentation.js               </a>                                           <a class="source" href="presenter.html">                 presenter.js               </a>                                           <a class="source" href="worker.html">                 worker.js               </a>                        </div>         </div>       </div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               presentation.js             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>               <p>This file manages everything related to <strong>the inside of a slide set</strong>. This includes
setting the font size, maintaining the aspect ratio and exposing the list of slides
to the parent frame.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="cm">/*jshint browser:true, mootools:true */</span></pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <h2>Presentation object</h2>

<p>The global presentation serves as an API for the parent document. It's <code>slide</code> and
<code>hide</code> properties can be set to control the visibility of slides. The <code>slides</code> property
in turn exposes the list of slides to the parent document.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="kd">var</span> <span class="nx">pik</span> <span class="o">=</span> <span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
	<span class="s2">&quot;use strict&quot;</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <p>Store the current, next and previous slide number</p>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="kd">var</span> <span class="nx">slide</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	    <span class="nx">next</span>  <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	    <span class="nx">prev</span>  <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <p>The API to the pik object</p>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="kd">var</span> <span class="nx">api</span> <span class="o">=</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="nb">Object</span><span class="p">.</span><span class="nx">prototype</span><span class="p">,</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <p>List of slides. Accessible by the parent document, set by the presentation
itself.</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="s1">&#39;slides&#39;</span><span class="o">:</span> <span class="p">{</span>
			<span class="nx">writable</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
			<span class="nx">enumerable</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
			<span class="nx">configurable</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
			<span class="nx">value</span><span class="o">:</span> <span class="p">[]</span>
		<span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <p>The <code>current</code> property can be set by the parent document to control which slide
is displayed. The as a result, the classes <code>pik-current</code>, <code>pik-next</code> and
<code>pik-previous</code> are assigned to the respective slides. This is accomplished by a
setter function that uses the <code>slide</code> variable to store the real value.</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="s1">&#39;slide&#39;</span><span class="o">:</span> <span class="p">{</span>
			<span class="nx">get</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span>
				<span class="k">return</span> <span class="nx">slide</span><span class="p">;</span>
			<span class="p">},</span>
			<span class="nx">set</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">x</span><span class="p">){</span></pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <p>Find out if this presentation instance is the first in the frame by
comparing the local slide variable with the result from the frame's
getCurrent(). If they differ, events won't be fired because they are
not needed in preview iframes.</p>             </td>             <td class="code">               <div class="highlight"><pre>				<span class="kd">var</span> <span class="nx">fire_events</span> <span class="o">=</span> <span class="p">(</span><span class="nx">x</span> <span class="o">===</span> <span class="nb">window</span><span class="p">.</span><span class="nx">parent</span><span class="p">.</span><span class="nx">pik</span><span class="p">.</span><span class="nx">getCurrent</span><span class="p">());</span></pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <p>Remove old slides' classes</p>             </td>             <td class="code">               <div class="highlight"><pre>				<span class="nx">$$</span><span class="p">(</span><span class="nx">pik</span><span class="p">.</span><span class="nx">slides</span><span class="p">[</span><span class="nx">slide</span><span class="p">]).</span><span class="nx">removeClass</span><span class="p">(</span><span class="s1">&#39;pik-current&#39;</span><span class="p">);</span>
				<span class="nx">$$</span><span class="p">(</span><span class="nx">pik</span><span class="p">.</span><span class="nx">slides</span><span class="p">[</span><span class="nx">next</span><span class="p">]).</span><span class="nx">removeClass</span><span class="p">(</span><span class="s1">&#39;pik-next&#39;</span><span class="p">);</span>
				<span class="nx">$$</span><span class="p">(</span><span class="nx">pik</span><span class="p">.</span><span class="nx">slides</span><span class="p">[</span><span class="nx">prev</span><span class="p">]).</span><span class="nx">removeClass</span><span class="p">(</span><span class="s1">&#39;pik-prev&#39;</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>               <p>Fire <code>slidedeactivate</code> event on the previously current slide</p>             </td>             <td class="code">               <div class="highlight"><pre>				<span class="k">if</span><span class="p">(</span><span class="nx">fire_events</span><span class="p">){</span>
					<span class="nx">$$</span><span class="p">(</span><span class="nx">pik</span><span class="p">.</span><span class="nx">slides</span><span class="p">[</span><span class="nx">slide</span><span class="p">]).</span><span class="nx">fireEvent</span><span class="p">(</span><span class="s1">&#39;slidedeactivate&#39;</span><span class="p">);</span>
				<span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-10">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>               <p>Set new slides</p>             </td>             <td class="code">               <div class="highlight"><pre>				<span class="nx">slide</span> <span class="o">=</span> <span class="nx">x</span><span class="p">;</span>
				<span class="nx">next</span>  <span class="o">=</span> <span class="nx">x</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
				<span class="nx">prev</span>  <span class="o">=</span> <span class="nx">x</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-11">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-11">&#182;</a>               </div>               <p>Set new slides' classes</p>             </td>             <td class="code">               <div class="highlight"><pre>				<span class="nx">$$</span><span class="p">(</span><span class="nx">pik</span><span class="p">.</span><span class="nx">slides</span><span class="p">[</span><span class="nx">slide</span><span class="p">]).</span><span class="nx">addClass</span><span class="p">(</span><span class="s1">&#39;pik-current&#39;</span><span class="p">);</span>
				<span class="nx">$$</span><span class="p">(</span><span class="nx">pik</span><span class="p">.</span><span class="nx">slides</span><span class="p">[</span><span class="nx">next</span><span class="p">]).</span><span class="nx">addClass</span><span class="p">(</span><span class="s1">&#39;pik-next&#39;</span><span class="p">);</span>
				<span class="nx">$$</span><span class="p">(</span><span class="nx">pik</span><span class="p">.</span><span class="nx">slides</span><span class="p">[</span><span class="nx">prev</span><span class="p">]).</span><span class="nx">addClass</span><span class="p">(</span><span class="s1">&#39;pik-prev&#39;</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-12">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-12">&#182;</a>               </div>               <p>Fire <code>slideactivate</code> event on the new current slide and the
<code>slidechange</code> event on the window object</p>             </td>             <td class="code">               <div class="highlight"><pre>				<span class="k">if</span><span class="p">(</span><span class="nx">fire_events</span><span class="p">){</span>
					<span class="nx">$$</span><span class="p">(</span><span class="nx">pik</span><span class="p">.</span><span class="nx">slides</span><span class="p">[</span><span class="nx">slide</span><span class="p">]).</span><span class="nx">fireEvent</span><span class="p">(</span><span class="s1">&#39;slideactivate&#39;</span><span class="p">);</span>
					<span class="nb">window</span><span class="p">.</span><span class="nx">fireEvent</span><span class="p">(</span><span class="s1">&#39;slidechange&#39;</span><span class="p">,</span> <span class="p">[</span><span class="nx">slide</span><span class="p">]);</span>
				<span class="p">}</span>
			<span class="p">}</span>
		<span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-13">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-13">&#182;</a>               </div>               <p>Toggle the hidden status by toggleing a class on the overlay.</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="s1">&#39;hide&#39;</span><span class="o">:</span> <span class="p">{</span>
			<span class="nx">set</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">status</span><span class="p">){</span>
				<span class="k">if</span><span class="p">(</span><span class="nx">status</span><span class="p">){</span>
					<span class="nx">$</span><span class="p">(</span><span class="s1">&#39;hide&#39;</span><span class="p">).</span><span class="nx">addClass</span><span class="p">(</span><span class="s1">&#39;pik-active&#39;</span><span class="p">);</span>
				<span class="p">}</span>
				<span class="k">else</span> <span class="p">{</span>
					<span class="nx">$</span><span class="p">(</span><span class="s1">&#39;hide&#39;</span><span class="p">).</span><span class="nx">removeClass</span><span class="p">(</span><span class="s1">&#39;pik-active&#39;</span><span class="p">);</span>
				<span class="p">}</span>
			<span class="p">}</span>
		<span class="p">}</span>

	<span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-14">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-14">&#182;</a>               </div>               <p>No accidential extensions to <code>api</code> please</p>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="nb">Object</span><span class="p">.</span><span class="nx">preventExtensions</span><span class="p">(</span><span class="nx">api</span><span class="p">);</span>
	<span class="k">return</span> <span class="nx">api</span><span class="p">;</span>

<span class="p">})();</span>


<span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
<span class="s2">&quot;use strict&quot;</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-15">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-15">&#182;</a>               </div>               <h2>Presentation setup</h2>

<p>Take care of the aspect ratio, font size and click events.</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nb">window</span><span class="p">.</span><span class="nx">addEvent</span><span class="p">(</span><span class="s1">&#39;domready&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(){</span></pre></div>             </td>           </tr>                               <tr id="section-16">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-16">&#182;</a>               </div>               <p>Store references to the slides in the global presentation object</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">$$</span><span class="p">(</span><span class="s1">&#39;.pik-slide&#39;</span><span class="p">).</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">element</span><span class="p">,</span> <span class="nx">index</span><span class="p">){</span>
	<span class="nx">pik</span><span class="p">.</span><span class="nx">slides</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">element</span><span class="p">);</span>
<span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-17">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-17">&#182;</a>               </div>               <p>Maintain a 4:3 aspect ratio, body positions, font and slide size</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="kd">var</span> <span class="nx">setFontFrameSizePosition</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(){</span>
	<span class="kd">var</span> <span class="nx">size</span>      <span class="o">=</span> <span class="nx">$$</span><span class="p">(</span><span class="s1">&#39;body&#39;</span><span class="p">).</span><span class="nx">getSize</span><span class="p">(),</span>
	    <span class="nx">ratio</span>     <span class="o">=</span> <span class="mi">4</span> <span class="o">/</span> <span class="mi">3</span><span class="p">,</span>
	    <span class="nx">newwidth</span>  <span class="o">=</span> <span class="p">(</span><span class="nx">size</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">x</span> <span class="o">&gt;</span> <span class="nx">size</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">y</span> <span class="o">*</span> <span class="nx">ratio</span><span class="p">)</span> <span class="o">?</span> <span class="nx">size</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">y</span> <span class="o">*</span> <span class="nx">ratio</span> <span class="o">:</span> <span class="nx">size</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">x</span><span class="p">,</span>
	    <span class="nx">newheight</span> <span class="o">=</span> <span class="p">(</span><span class="nx">size</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">x</span> <span class="o">&gt;</span> <span class="nx">size</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">y</span> <span class="o">*</span> <span class="nx">ratio</span><span class="p">)</span> <span class="o">?</span> <span class="nx">size</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">y</span> <span class="o">:</span> <span class="nx">size</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">x</span> <span class="o">/</span> <span class="nx">ratio</span><span class="p">,</span>
	    <span class="nx">topmargin</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">((</span><span class="nx">size</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">y</span> <span class="o">-</span> <span class="nx">newheight</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span>
	    <span class="nx">fontsize</span>  <span class="o">=</span> <span class="p">(</span><span class="nx">newheight</span> <span class="o">+</span> <span class="nx">newwidth</span><span class="p">)</span> <span class="o">/</span> <span class="mi">6</span><span class="p">;</span>
	<span class="nx">$</span><span class="p">(</span><span class="s1">&#39;Pik-presentation-container&#39;</span><span class="p">).</span><span class="nx">setStyles</span><span class="p">({</span>
		<span class="s1">&#39;width&#39;</span>     <span class="o">:</span> <span class="nx">newwidth</span>  <span class="o">+</span> <span class="s1">&#39;px&#39;</span><span class="p">,</span>
		<span class="s1">&#39;height&#39;</span>    <span class="o">:</span> <span class="nx">newheight</span> <span class="o">+</span> <span class="s1">&#39;px&#39;</span><span class="p">,</span>
		<span class="s1">&#39;font-size&#39;</span> <span class="o">:</span> <span class="nx">fontsize</span>  <span class="o">+</span> <span class="s1">&#39;%&#39;</span><span class="p">,</span>
		<span class="s1">&#39;top&#39;</span>       <span class="o">:</span> <span class="nx">topmargin</span> <span class="o">+</span> <span class="s1">&#39;px&#39;</span>
	<span class="p">});</span>
<span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-18">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-18">&#182;</a>               </div>               <p>Resize and reposition on resize and load</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nb">window</span><span class="p">.</span><span class="nx">addEvent</span><span class="p">(</span><span class="s1">&#39;load&#39;</span><span class="p">,</span> <span class="nx">setFontFrameSizePosition</span><span class="p">);</span>
<span class="nb">window</span><span class="p">.</span><span class="nx">addEvent</span><span class="p">(</span><span class="s1">&#39;resize&#39;</span><span class="p">,</span> <span class="nx">setFontFrameSizePosition</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-19">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-19">&#182;</a>               </div>               <p>If there are "browse" links in the presentation, set the browser windows title back
to default</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">$$</span><span class="p">(</span><span class="s1">&#39;#Pik-browse&#39;</span><span class="p">).</span><span class="nx">addEvent</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(){</span>
	<span class="nb">window</span><span class="p">.</span><span class="nx">parent</span><span class="p">.</span><span class="nx">$$</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">).</span><span class="nx">set</span><span class="p">(</span><span class="s1">&#39;text&#39;</span><span class="p">,</span> <span class="s1">&#39;Browse presentations&#39;</span><span class="p">);</span>
<span class="p">});</span>

<span class="p">});</span>

<span class="p">})();</span>

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 